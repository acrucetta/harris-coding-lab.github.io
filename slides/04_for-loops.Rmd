---
title: "Coding Lab: For Loops"
author: "Ari Anisfeld, Angela Li"
date: "10/22/2019"
output:
  ioslides_presentation
---
```{r, setup=TRUE, message=FALSE, echo=FALSE}
library(tidyverse)
library(readxl)
```

## Lecture Outline

 - Review: Vectorized operations
 - For loops
 - Best practices for loops
 - ggplot2 intro

## Review: Vectorized operations

When possible, take advantage of the fact that R is vectorized.

```{r}
a <- 7:11
b <- 8:12
out <- c()

for (i in seq_along(a)) {
  out[i] <- a[i] + b[i]
}

out
```

This is a bad example of a for loop!

## The better alternative: vectorized addition

```{r}
a <- 7:11
b <- 8:12
out <- a + b

out
```

Use vectorized operations and tidyverse functions like `mutate()` when you can.


## Simple example: printing output

```{r}
print(1)
print(2)
# and so on...
print(10)
```

## Simple example: printing output

Replace something you want to repeat multiple times with a for loop!

```{r}
for (i in 1:10) {
  print(i)
}
```

## For loops

The general structure of a for loop is as follows:

```{r eval=FALSE}
for (item in list_of_items) {
  do something to each item
}

for (index in list_of_indices) {
  do something based on index
}
```

## Another example: find sample means

Suppose we want to find the means of increasingly large samples.

```{r}
mean1 <- mean(rnorm(5))
mean2 <- mean(rnorm(10))
mean3 <- mean(rnorm(15))
mean4 <- mean(rnorm(20))
mean5 <- mean(rnorm(25))

means <- c(mean1, mean2, mean3, mean4, mean5)

means
```

## Recall `rnorm()`

Take `n` random draws from a normal distribution.

**Usage**
`rnorm(n, mean = 0, sd = 1)`

**Example**
```{r}
rnorm(5)
rnorm(10)
```


## Another example: find sample means

Let's avoid repeating code with a `for` loop.

```{r}
sample_sizes <- c(5, 10, 15, 20, 25)
sample_means <- rep(0, length(sample_sizes))

for (i in seq_along(sample_sizes)) {
  sample_means[i] <- mean(rnorm(sample_sizes[i]))
}

sample_means
```

## Finding sample means, broken down {.build}

Assign initial variables outside of the body of the for loop.

```{r eval=FALSE}
sample_sizes <- c(5, 10, 15, 20, 25)
sample_means <- rep(0, length(sample_sizes))
```

To start: 

1. create a vector of the `sample_sizes` we want to use
2. create a vector to store the output 

## What does `sample_means` currently look like?

```{r}
sample_means <- rep(0, length(sample_sizes))
sample_means
```


## Adding data to a vector, broken down {.build}

Determine what sequence to loop over. 

```{r eval=FALSE}
for (i in 1:length(sample_sizes)) {

}
```


## A helper function `seq_along()`

`seq_along(.)` is synonymous to `1:length(.)` 

where `.` is a vector.

**Example**
```{r}
vec <- c("x", "y", "z")
1:length(vec)
seq_along(vec)
```

***
```{r}
sample_sizes <- c(5, 10, 15, 20, 25)
seq_along(sample_sizes)
```

(What if `sample_sizes` is accidentally a 0-length vector? See [what happens](https://r4ds.had.co.nz/iteration.html#for-loops) in R for Data Science.)


## Adding data to a vector, broken down 

```{r eval=FALSE}
sample_sizes <- c(5, 10, 15, 20, 25)
sample_means <- rep(0, length(sample_sizes))

for (i in seq_along(sample_sizes)) {

}
```

Use `seq_along()` to be safe! 


## Adding data to a vector, broken down {.build}

```{r}
sample_sizes <- c(5, 10, 15, 20, 25)
sample_means <- rep(0, length(sample_sizes))

for (i in seq_along(sample_sizes)) {
  mean(rnorm(i))
}

sample_means
```

Right now, we're calculating the mean, but it's not being saved anywhere.

## Adding data to a vector, broken down {.build}

```{r}
sample_sizes <- c(5, 10, 15, 20, 25)
means <- numeric(length(sample_sizes))

for (i in seq_along(sample_sizes)) {
  
  this_sample_mean <- mean(rnorm(i))
  
  sample_means[i] <- this_sample_mean
}

sample_means
```

Save the mean of the sample to the ith place of the `sample_means` vector.

## Moving beyond 1 dimension

What if we wanted to store the sample size *and* the mean of the sample?

We can store the output as a tibble.
```{r}
sample_sizes <- c(5, 10, 15, 20, 25)
means_df <- tibble()

for (n in sample_sizes) {
  sample_mean <- mean(rnorm(n))
  new_row <- c(sample_size = n, sample_mean = sample_mean)
  means_df <- bind_rows(means_df, new_row)
}
```

***
```{r}
means_df
```

## bind_rows()? {.build}

`bind_rows()` adds a new row to a dataframe, or combines two vectors into a dataframe:

```{r}
library(tidyverse)

bind_rows(c(col1 = 1, col2 = "A"), 
          c(col1 = 2, col2 = "B"))
```
***
In our case, add a row with the sample size and the sample mean every time we go through the loop:

```{r eval=FALSE}
new_row <- c(sample_size = n, sample_mean = sample_mean)
bind_rows(means_df, new_row)
```

## bind_rows() common error

```{r eval= FALSE}
new_row <- c(40, mean(rnorm(40)))
bind_rows(means_df, new_row)
```
Error: Argument 2 must have names

***

A row is a named vector! 

```{r eval=TRUE}
new_row <- c(n = 40, sample_mean = mean(rnorm(40)))
bind_rows(means_df, new_row)
```

## Best practices for loops

1. Use vectorized operations when possible
2. Pre-allocate your data storage
3. Use functions instead (next week!)

## ggplot2 intro

3 parts to a ggplot2 call:

1. data
2. aesthetics
3. geometry

<img src="images/04_ggplot2.png" width="400px" />


## Texas Housing Example

```{r warning=FALSE}
ggplot(data = txhousing, aes(x = listings, y = sales)) +
  geom_point()
```

## Break it down
We start with data.
```{r eval=FALSE}
ggplot(data = txhousing, _____) +
  _____
```

## Break it down
We map columns from the data to `x` and `y` in `aes()`
```{r eval=FALSE}
ggplot(data = txhousing, aes(x = listings, y = sales)) +
  _____
```

## Break it down
We tell R how to display the data (i.e. as points.)
```{r eval=FALSE}
ggplot(data = txhousing, aes(x = listings, y = sales)) +
  geom_point()
```

## Adding an aesthetic

```{r eval=FALSE}
txhousing %>%
  ggplot(aes(x = listings, y = sales, color = year)) +
  geom_point()
```

For more resources, checkout [chapter 3 of R for Data Science](https://r4ds.had.co.nz/data-visualisation.html)


## Recap

Today we:

- Reviewed vectorization
- Introduced for loops
- Discussed best practices for loops
- Went over the basics of ggplot2

Next week: writing functions

Find the workshop link on the course web page:
http://harris-coding-lab.github.io
